/*! dmv - v0.1.0 - 2/29/2012
* https://github.com/rwldrn/dmv
* Copyright (c) 2012 Rick Waldron <waldron.rick@gmail.com>; Licensed MIT */
(function(a){var b=a.navigator,c=function(a){var c=b.getUserMedia||b.webkitGetUserMedia,d=b.getUserMedia?{video:!0,audio:!0}:"video audio";c.call(b,d,function(b){var c=window.webkitURL?window.webkitURL.createObjectURL(b):b;a(c)})},d,e;d=function(a,b){this.id=a,this.media=d.fixture("video",this.id),this.canvas=d.fixture("canvas",this.id),this.context=this.canvas.getContext("2d"),this.socket=b,this.dataUri="",c(function(a){this.media.src=a,this.media.addEventListener("loadedmetadata",function(){this.media.play()}.bind(this),!1),this.media.addEventListener("timeupdate",function(){this.draw()}.bind(this),!1)}.bind(this))},d.prototype.draw=function(){this.context.drawImage(this.media,0,0,this.canvas.width,this.canvas.height)},d.prototype.capture=function(){var a=this.canvas.toDataURL();this.socket.emit("capture",{id:this.id,captured:this.canvas.toDataURL()})},d.id=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.random()*16|0;return(a==="x"?b:b&3|8).toString(16)}).toUpperCase()},d.fixture=function(a,b){var c=document.querySelector("#container"),d=document.createElement(a),e;return d.id=a[0]+"_"+b,console.log(a,window.innerWidth,window.innerHeight),d.style.width=window.innerWidth+"px",c||(c=document.body),a==="canvas"&&(e=document.querySelector("video[id$='"+b+"']"),setTimeout(function f(){e.videoWidth>0?(d.width=e.videoWidth,d.height=e.videoHeight,d.style.visibility="hidden"):setTimeout(f,10)},10)),c.appendChild(d),d},d.exists=function(a){return!!document.querySelectorAll("[id$='"+a+"']").length},e={socket:null,operator:null,init:function(a){var b,c;b=localStorage.getItem("id"),b||(b=d.id(),localStorage.setItem("id",b)),e.socket=a,e.operator=new d(b,a),this.listen()},listen:function(){var a=document.querySelector("video");a.addEventListener("click",e.operator.capture.bind(e.operator),!1)}},a.DMV=e,a.Operator=d})(typeof exports=="object"&&exports||this)